<!DOCTYPE html>
<html lang="fr">
<head>
<meta charset="UTF-8" />
<title>Admin Data Generator</title>
<style>
    body { font-family: Arial; padding: 20px; }
    textarea { width: 100%; height: 150px; }
    button { margin: 10px 0; padding: 8px 14px; }
    .block { border: 1px solid #ddd; padding: 15px; margin-bottom: 20px; }
</style>
</head>
<body>

<h1>Admin – Générateur de data.js</h1>

<p><b>Important :</b> Cette page fonctionne 100% en local — aucun lien avec Firebase.</p>

<div class="block">
    <h2>1. Importer vos fichiers actuels</h2>

    <p>Colle ici ton <b>data.js</b> :</p>
    <textarea id="data1"></textarea>

    <p>Colle ici ton <b>data2.js</b> :</p>
    <textarea id="data2"></textarea>

    <p>Colle ici ton <b>data3.js</b> :</p>
    <textarea id="data3"></textarea>

    <p>Colle ici ton <b>data2026mj.js</b> :</p>
    <textarea id="data2026mj"></textarea>
</div>

<div class="block">
    <h2>2. Nouvelle semaine</h2>
    <label>Nom de la nouvelle semaine :</label>
    <input id="newWeek" type="text" placeholder="S16" />
</div>

<div class="block">
    <h2>3. Ajouter les scores</h2>
    <p>Format : <code>Nom: score</code> (un par ligne)</p>
    <textarea id="scoresInput" placeholder="Rico: 55&#10;Ghost: 48"></textarea>
</div>

<div class="block">
    <h2>4. Ajouter les stats détaillées (data2.js)</h2>
    <p>Format : <code>Nom: w,svp,k,a</code></p>
    <textarea id="detailsInput" placeholder="Rico: 3,1,40,4"></textarea>
</div>

<div class="block">
    <h2>5. Générer fichiers</h2>

    <button onclick="generateDataJS()">Générer data.js</button>
    <textarea id="output1"></textarea>

    <button onclick="generateData2JS()">Générer data2.js</button>
    <textarea id="output2"></textarea>

    <button onclick="generateData3JS()">Générer data3.js</button>
    <textarea id="output3"></textarea>

    <button onclick="generateData2026MJJS()">Générer data2026mj.js</button>
    <textarea id="output4"></textarea>
</div>


<script>
// -------------------------------
//  PARSE JAVASCRIPT SAFE (pas JSON)
// -------------------------------
function extractJSValue(text, regex) {
    const match = text.match(regex);
    if (!match) throw new Error("Pattern introuvable");

    const code = match[1];

    // On évalue proprement l’expression JS
    return Function(`"use strict"; return (${code});`)();
}

// ----------- PARSE data.js -----------
function parseDataJS(text) {
    try {
        const weeks = extractJSValue(text, /export\s+const\s+weeks\s*=\s*(\[[\s\S]*?\]);/);
        const rawData = extractJSValue(text, /export\s+let\s+rawData\s*=\s*(\[[\s\S]*?\]);/);

        return { weeks, rawData };
    } catch (e) {
        alert("Erreur parsing data.js : " + e);
        return null;
    }
}

// ----------- PARSE data2.js -----------
function parseData2(text) {
    try {
        const detailedData = extractJSValue(text, /export\s+const\s+detailedData\s*=\s*({[\s\S]*});/);
        return detailedData;
    } catch (e) {
        alert("Erreur parsing data2.js : " + e);
        return null;
    }
}

// ----------- PARSE data3.js -----------
function parseData3(text) {
    try {
        const weeks = extractJSValue(text, /export\s+const\s+weeks\s*=\s*(\[[\s\S]*?\]);/);
        const brData = extractJSValue(text, /export\s+const\s+brData\s*=\s*(\[[\s\S]*?\]);/);

        return { weeks, brData };
    } catch (e) {
        alert("Erreur parsing data3.js : " + e);
        return null;
    }
}

// ----------- PARSE data2026mj.js -----------
function parseData2026MJ(text) {
    try {
        const detailedData2026 = extractJSValue(text, /export\s+const\s+detailedData2026\s*=\s*({[\s\S]*});/);
        return detailedData2026;
    } catch (e) {
        alert("Erreur parsing data2026mj.js : " + e);
        return null;
    }
}


// ---------------------------------------------------
//  Générateur data.js
// ---------------------------------------------------
function generateDataJS() {
    const raw = document.getElementById("data1").value;
    const parsed = parseDataJS(raw);
    if (!parsed) return;

    let { weeks, rawData } = parsed;

    const newWeek = document.getElementById("newWeek").value.trim();
    const scores = document.getElementById("scoresInput").value.trim().split("\n");

    if (!newWeek) return alert("Missing week name");

    weeks.push(newWeek);

    const scoreMap = {};
    scores.forEach(line => {
        const [name, val] = line.split(":").map(s => s.trim());
        if (name && val) scoreMap[name] = parseFloat(val);
    });

    rawData = rawData.map(player => {
        const score = scoreMap[player.name] ?? null;
        return {
            name: player.name,
            scores: [...player.scores, score]
        };
    });

    const finalTxt =
`export const weeks = ${JSON.stringify(weeks)};
export let rawData = ${JSON.stringify(rawData, null, 4)};`;

    document.getElementById("output1").value = finalTxt;
}


// ---------------------------------------------------
//  Générateur data2.js
// ---------------------------------------------------
function generateData2JS() {
    const raw = document.getElementById("data2").value;
    const detailedData = parseData2(raw);
    if (!detailedData) return;

    const newWeek = document.getElementById("newWeek").value.trim();
    const lines = document.getElementById("detailsInput").value.trim().split("\n");

    const map = {};
    lines.forEach(l => {
        const [name, vals] = l.split(":").map(x => x.trim());
        if (!name || !vals) return;
        const [w, svp, k, a] = vals.split(",").map(v => parseInt(v.trim()));
        map[name] = { w, svp, k, a };
    });

    for (const name in map) {
        if (!detailedData[name]) detailedData[name] = {};
        detailedData[name][newWeek] = map[name];
    }

    const finalTxt =
`export const detailedData = ${JSON.stringify(detailedData, null, 4)};`;

    document.getElementById("output2").value = finalTxt;
}


// ---------------------------------------------------
//  Générateur data3.js
// ---------------------------------------------------
function generateData3JS() {
    const raw = document.getElementById("data3").value;
    const parsed = parseData3(raw);
    if (!parsed) return;

    let { weeks, brData } = parsed;

    const newWeek = document.getElementById("newWeek").value.trim();
    const scores = document.getElementById("scoresInput").value.trim().split("\n");

    weeks.push(newWeek);

    const scoreMap = {};
    scores.forEach(line => {
        const [name, val] = line.split(":").map(s => s.trim());
        if (name && val) scoreMap[name] = parseFloat(val);
    });

    brData = brData.map(player => ({
        name: player.name,
        scores: [...player.scores, scoreMap[player.name] ?? null]
    }));

    const finalTxt =
`export const weeks = ${JSON.stringify(weeks)};
export const brData = ${JSON.stringify(brData, null, 4)};`;

    document.getElementById("output3").value = finalTxt;
}


// ---------------------------------------------------
//  Générateur data2026mj.js
// ---------------------------------------------------
function generateData2026MJJS() {
    const raw = document.getElementById("data2026mj").value;
    const detailedData2026 = parseData2026MJ(raw);
    if (!detailedData2026) return;

    const newWeek = document.getElementById("newWeek").value.trim();
    const lines = document.getElementById("detailsInput").value.trim().split("\n");

    const map = {};
    lines.forEach(l => {
        const [name, vals] = l.split(":").map(x => x.trim());
        if (!name || !vals) return;
        const [w, svp, k, a] = vals.split(",").map(v => parseInt(v.trim()));
        map[name] = { w, svp, k, a };
    });

    for (const name in map) {
        if (!detailedData2026[name]) detailedData2026[name] = {};
        detailedData2026[name][newWeek] = map[name];
    }

    const finalTxt =
`export const detailedData2026 = ${JSON.stringify(detailedData2026, null, 4)};`;

    document.getElementById("output4").value = finalTxt;
}

</script>

</body>
</html>
